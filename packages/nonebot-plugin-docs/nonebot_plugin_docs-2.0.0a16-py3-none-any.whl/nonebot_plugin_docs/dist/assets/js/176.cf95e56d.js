(window.webpackJsonp=window.webpackJsonp||[]).push([[176],{479:function(t,s,a){"use strict";a.r(s);var e=a(21),n=Object(e.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"cqhttp-协议使用指南"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#cqhttp-协议使用指南"}},[t._v("#")]),t._v(" CQHTTP 协议使用指南")]),t._v(" "),a("h2",{attrs:{id:"安装-nonebot-cqhttp-适配器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装-nonebot-cqhttp-适配器"}},[t._v("#")]),t._v(" 安装 NoneBot CQHTTP 适配器")]),t._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("pip "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" nonebot-adapter-cqhttp\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])]),a("h2",{attrs:{id:"配置-cqhttp-协议端-以-qq-为例"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#配置-cqhttp-协议端-以-qq-为例"}},[t._v("#")]),t._v(" 配置 CQHTTP 协议端（以 QQ 为例）")]),t._v(" "),a("p",[t._v("单纯运行 NoneBot 实例并不会产生任何效果，因为此刻 QQ 这边还不知道 NoneBot 的存在，也就无法把消息发送给它，因此现在需要使用一个无头 QQ 来把消息等事件上报给 NoneBot。")]),t._v(" "),a("p",[t._v("QQ 协议端举例:")]),t._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://github.com/Mrs4s/go-cqhttp",target:"_blank",rel:"noopener noreferrer"}},[t._v("go-cqhttp"),a("OutboundLink")],1),t._v(" (基于 "),a("a",{attrs:{href:"https://github.com/Mrs4s/MiraiGo",target:"_blank",rel:"noopener noreferrer"}},[t._v("MiraiGo"),a("OutboundLink")],1),t._v(")")]),t._v(" "),a("li",[a("a",{attrs:{href:"https://github.com/yyuueexxiinngg/onebot-kotlin",target:"_blank",rel:"noopener noreferrer"}},[t._v("onebot-kotlin"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"https://github.com/mamoe/mirai",target:"_blank",rel:"noopener noreferrer"}},[t._v("Mirai"),a("OutboundLink")],1),t._v(" + "),a("a",{attrs:{href:"https://github.com/yyuueexxiinngg/onebot-kotlin",target:"_blank",rel:"noopener noreferrer"}},[t._v("onebot-mirai"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"https://github.com/mamoe/mirai",target:"_blank",rel:"noopener noreferrer"}},[t._v("Mirai"),a("OutboundLink")],1),t._v(" + "),a("a",{attrs:{href:"https://github.com/iTXTech/mirai-native",target:"_blank",rel:"noopener noreferrer"}},[t._v("Mirai Native"),a("OutboundLink")],1),t._v(" + "),a("a",{attrs:{href:"https://github.com/richardchien/coolq-http-api",target:"_blank",rel:"noopener noreferrer"}},[t._v("CQHTTP"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"https://github.com/takayama-lily/node-onebot",target:"_blank",rel:"noopener noreferrer"}},[t._v("node-onebot"),a("OutboundLink")],1),t._v(" (基于 "),a("a",{attrs:{href:"https://github.com/takayama-lily/abot",target:"_blank",rel:"noopener noreferrer"}},[t._v("abot"),a("OutboundLink")],1),t._v(", "),a("a",{attrs:{href:"https://github.com/takayama-lily/oicq",target:"_blank",rel:"noopener noreferrer"}},[t._v("OICQ"),a("OutboundLink")],1),t._v(")")])]),t._v(" "),a("p",[t._v("这里以 "),a("a",{attrs:{href:"https://github.com/Mrs4s/go-cqhttp",target:"_blank",rel:"noopener noreferrer"}},[t._v("go-cqhttp"),a("OutboundLink")],1),t._v(" 为例")]),t._v(" "),a("ol",[a("li",[t._v("下载 go-cqhttp 对应平台的 release 文件，"),a("a",{attrs:{href:"https://github.com/Mrs4s/go-cqhttp/releases",target:"_blank",rel:"noopener noreferrer"}},[t._v("点此前往"),a("OutboundLink")],1)]),t._v(" "),a("li",[t._v("运行 exe 文件或者使用 "),a("code",[t._v("./go-cqhttp")]),t._v(" 启动")]),t._v(" "),a("li",[t._v("生成默认配置文件并修改默认配置")])]),t._v(" "),a("h3",{attrs:{id:"选项-1-反向-websocket-连接"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#选项-1-反向-websocket-连接"}},[t._v("#")]),t._v(" 选项 1 反向 WebSocket 连接")]),t._v(" "),a("div",{staticClass:"language-yml line-numbers-mode"},[a("div",{staticClass:"highlight-lines"},[a("br"),a("div",{staticClass:"highlighted"},[t._v(" ")]),a("div",{staticClass:"highlighted"},[t._v(" ")]),a("br"),a("br"),a("div",{staticClass:"highlighted"},[t._v(" ")]),a("br"),a("br"),a("br"),a("div",{staticClass:"highlighted"},[t._v(" ")]),a("br")]),a("pre",{pre:!0,attrs:{class:"language-yml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("account")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("uin")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 机器人QQ号\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("password")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"机器人密码"')]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("message")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("post-format")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" array\n\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("servers")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ws-reverse")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("universal")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ws"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("//127.0.0.1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("8080/cqhttp/ws\n")])]),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br")])]),a("p",[t._v("其中 "),a("code",[t._v("ws://127.0.0.1:8080/cqhttp/ws")]),t._v(" 中的 "),a("code",[t._v("127.0.0.1")]),t._v(" 和 "),a("code",[t._v("8080")]),t._v(" 应分别对应 nonebot 配置的 HOST 和 PORT。")]),t._v(" "),a("p",[a("code",[t._v("cqhttp")]),t._v(" 是前述 "),a("code",[t._v("register_adapter")]),t._v(" 时传入的第一个参数，代表设置的 "),a("code",[t._v("CQHTTPBot")]),t._v(" 适配器的路径，你可以对不同的适配器设置不同路径以作区别。")]),t._v(" "),a("h3",{attrs:{id:"选项-2-http-post-上报"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#选项-2-http-post-上报"}},[t._v("#")]),t._v(" 选项 2 HTTP POST 上报")]),t._v(" "),a("div",{staticClass:"language-yml line-numbers-mode"},[a("div",{staticClass:"highlight-lines"},[a("br"),a("div",{staticClass:"highlighted"},[t._v(" ")]),a("div",{staticClass:"highlighted"},[t._v(" ")]),a("br"),a("br"),a("div",{staticClass:"highlighted"},[t._v(" ")]),a("br"),a("br"),a("br"),a("br"),a("div",{staticClass:"highlighted"},[t._v(" ")]),a("br"),a("br")]),a("pre",{pre:!0,attrs:{class:"language-yml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("account")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("uin")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 机器人QQ号\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("password")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"机器人密码"')]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("message")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("post-format")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" array\n\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("servers")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("http")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("post")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("url")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"http://127.0.0.1:8080/cqhttp/http"')]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("secret")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),t._v("\n")])]),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br")])]),a("p",[t._v("其中 "),a("code",[t._v("ws://127.0.0.1:8080/cqhttp/http")]),t._v(" 中的 "),a("code",[t._v("127.0.0.1")]),t._v(" 和 "),a("code",[t._v("8080")]),t._v(" 应分别对应 nonebot 配置的 HOST 和 PORT。")]),t._v(" "),a("p",[a("code",[t._v("cqhttp")]),t._v(" 是前述 "),a("code",[t._v("register_adapter")]),t._v(" 时传入的第一个参数，代表设置的 "),a("code",[t._v("CQHTTPBot")]),t._v(" 适配器的路径，你可以对不同的适配器设置不同路径以作区别。")]),t._v(" "),a("h3",{attrs:{id:"选项-3-正向-websocket-连接"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#选项-3-正向-websocket-连接"}},[t._v("#")]),t._v(" 选项 3 正向 WebSocket 连接")]),t._v(" "),a("div",{staticClass:"language-yml line-numbers-mode"},[a("div",{staticClass:"highlight-lines"},[a("br"),a("div",{staticClass:"highlighted"},[t._v(" ")]),a("div",{staticClass:"highlighted"},[t._v(" ")]),a("br"),a("br"),a("div",{staticClass:"highlighted"},[t._v(" ")]),a("br"),a("br"),a("br"),a("div",{staticClass:"highlighted"},[t._v(" ")]),a("div",{staticClass:"highlighted"},[t._v(" ")]),a("br")]),a("pre",{pre:!0,attrs:{class:"language-yml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("account")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("uin")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 机器人QQ号\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("password")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"机器人密码"')]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("message")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("post-format")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" array\n\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("servers")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ws")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("host")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 127.0.0.1\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("port")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("6700")]),t._v("\n")])]),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br")])]),a("p",[t._v("NoneBot 配置")]),t._v(" "),a("div",{staticClass:"language-dotenv line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('CQHTTP_WS_URLS={"机器人QQ号": "ws://127.0.0.1:6700/"}\n')])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])]),a("p",[t._v("其中 "),a("code",[t._v("ws://127.0.0.1:6700/")]),t._v(" 中的 "),a("code",[t._v("127.0.0.1")]),t._v(" 和 "),a("code",[t._v("6700")]),t._v(" 应分别对应 go-cqhttp 配置的 HOST 和 PORT。")]),t._v(" "),a("p",[t._v("正向连接可以选择支持客户端连接方式的 "),a("code",[t._v("Driver")]),t._v(" 来进行连接，请根据需求进行选择：")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("nonebot.drivers.fastapi")]),t._v(": 同时支持正向和反向")]),t._v(" "),a("li",[a("code",[t._v("nonebot.drivers.aiohttp")]),t._v(": 仅支持正向")])]),t._v(" "),a("h2",{attrs:{id:"历史性的第一次对话"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#历史性的第一次对话"}},[t._v("#")]),t._v(" 历史性的第一次对话")]),t._v(" "),a("p",[t._v("一旦新的配置文件正确生效之后，NoneBot 所在的控制台（如果正在运行的话）应该会输出类似下面的内容（两条访问日志）：")]),t._v(" "),a("div",{staticClass:"language-default line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("09-14 21:31:16 [INFO] uvicorn | ('127.0.0.1', 12345) - \"WebSocket /cqhttp/ws\" [accepted]\n09-14 21:31:16 [INFO] nonebot | WebSocket Connection from CQHTTP Bot 你的QQ号 Accepted!\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br")])]),a("p",[t._v("这表示 CQHTTP 协议端已经成功地使用 CQHTTP 协议连接上了 NoneBot。")]),t._v(" "),a("p",[t._v("现在，尝试向你的机器人账号发送如下内容：")]),t._v(" "),a("div",{staticClass:"language-default line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("/echo 你好，世界\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])]),a("p",[t._v("到这里如果一切 OK，你应该会收到机器人给你回复了 "),a("code",[t._v("你好，世界")]),t._v("。这一历史性的对话标志着你已经成功地运行了一个 NoneBot 的最小实例，开始了编写更强大的 QQ 机器人的创意之旅！")]),t._v(" "),a("ClientOnly",[a("Messenger",{attrs:{messages:[{position:"right",msg:"/echo 你好，世界"},{position:"left",msg:"你好，世界"}]}})],1)],1)}),[],!1,null,null,null);s.default=n.exports}}]);