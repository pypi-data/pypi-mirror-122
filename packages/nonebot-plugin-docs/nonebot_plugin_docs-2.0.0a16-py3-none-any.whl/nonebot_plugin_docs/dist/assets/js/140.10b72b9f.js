(window.webpackJsonp=window.webpackJsonp||[]).push([[140],{615:function(t,s,a){"use strict";a.r(s);var n=a(21),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"飞书机器人使用指南"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#飞书机器人使用指南"}},[t._v("#")]),t._v(" 飞书机器人使用指南")]),t._v(" "),a("p",[t._v("基于飞书开放平台事件回调与 API 进行机器人适配，目前仅适配企业自建应用。")]),t._v(" "),a("h2",{attrs:{id:"安装-nonebot-飞书-适配器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装-nonebot-飞书-适配器"}},[t._v("#")]),t._v(" 安装 NoneBot 飞书 适配器")]),t._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("pip "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" nonebot-adapter-feishu\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])]),a("h2",{attrs:{id:"创建应用与启用应用-机器人-能力"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#创建应用与启用应用-机器人-能力"}},[t._v("#")]),t._v(" 创建应用与启用应用“机器人”能力")]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),a("p",[t._v("此部分可参考"),a("a",{attrs:{href:"https://open.feishu.cn/document/home/develop-a-bot-in-5-minutes/create-an-app",target:"_blank",rel:"noopener noreferrer"}},[t._v("飞书开放平台-快速开发机器人-创建应用"),a("OutboundLink")],1),t._v("部分的文档。")])]),t._v(" "),a("h2",{attrs:{id:"开启应用权限"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#开启应用权限"}},[t._v("#")]),t._v(" 开启应用权限")]),t._v(" "),a("p",[t._v("应用拥有所需权限后，才能调用飞书接口获取相关信息。如果需要用到所有飞书平台的 API，请开启所有应用权限。")]),t._v(" "),a("p",[t._v("在仅群聊功能的情况下，需要为应用开启用户、消息、通讯录和群聊权限组所有权限。")]),t._v(" "),a("h2",{attrs:{id:"配置飞书事件订阅"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#配置飞书事件订阅"}},[t._v("#")]),t._v(" 配置飞书事件订阅")]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),a("p",[t._v("在添加事件订阅时请注意，带有**（历史版本）"),a("strong",[t._v("字样的事件的格式为")]),t._v("不受支持的旧版事件格式**，请使用对应的"),a("strong",[t._v("新版事件（不带历史版本字样）作为替代")]),t._v("。")])]),t._v(" "),a("p",[t._v("目前，飞书适配器支持以下事件：")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("事件名称")]),t._v(" "),a("th",[t._v("事件描述")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("接收消息")]),t._v(" "),a("td",[t._v("机器人接收到用户发送的消息。")])]),t._v(" "),a("tr",[a("td",[t._v("消息已读")]),t._v(" "),a("td",[t._v("用户阅读机器人发送的单聊消息。")])]),t._v(" "),a("tr",[a("td",[t._v("群解散")]),t._v(" "),a("td",[t._v("群组被解散。")])]),t._v(" "),a("tr",[a("td",[t._v("群配置更改")]),t._v(" "),a("td",[t._v("群组配置被修改后触发此事件，包含：群主转移、群基本信息修改、群权限修改。")])]),t._v(" "),a("tr",[a("td",[t._v("机器人进群")]),t._v(" "),a("td",[t._v("机器人被添加至群聊。")])]),t._v(" "),a("tr",[a("td",[t._v("机器人被移出群")]),t._v(" "),a("td",[t._v("机器人被移出群聊。")])]),t._v(" "),a("tr",[a("td",[t._v("用户进群")]),t._v(" "),a("td",[t._v("新用户进群。")])]),t._v(" "),a("tr",[a("td",[t._v("撤销拉用户进群")]),t._v(" "),a("td",[t._v("撤销拉用户进群。")])]),t._v(" "),a("tr",[a("td",[t._v("用户被移出群")]),t._v(" "),a("td",[t._v("用户主动退群或被移出群聊。")])])])]),t._v(" "),a("h2",{attrs:{id:"在-nonebot-配置中添加相应配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#在-nonebot-配置中添加相应配置"}},[t._v("#")]),t._v(" 在 NoneBot 配置中添加相应配置")]),t._v(" "),a("p",[t._v("在 "),a("code",[t._v(".env")]),t._v(" 文件中添加以下配置")]),t._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("APP_ID=<yourAppId>\nAPP_SECRET=<yourAppSecret>\nVERIFICATION_TOKEN=<yourVerificationToken>\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br")])]),a("p",[t._v("复制所创建应用**“凭证和基础信息”**中的 "),a("strong",[t._v("App ID")]),t._v(" 、 "),a("strong",[t._v("App Secret")]),t._v(" 和 "),a("strong",[t._v("“事件订阅”")]),t._v(" 中的 "),a("strong",[t._v("Verification Token")]),t._v(" ，替换上面相应的配置的值。")]),t._v(" "),a("p",[t._v("此外，对于飞书平台的事件订阅加密机制，飞书适配器也提供 "),a("code",[t._v("ENCRYPT_KEY")]),t._v(" 配置项。")]),t._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("ENCRYPT_KEY=<yourEncryptKey>\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])]),a("p",[t._v("当此项不为空时，飞书适配器会认为用户启用了加密机制，并对事件上报中的密文进行解密。")]),t._v(" "),a("p",[t._v("对于"),a("a",{attrs:{href:"https://www.larksuite.com",target:"_blank",rel:"noopener noreferrer"}},[t._v("Lark(飞书平台海外版)"),a("OutboundLink")],1),t._v(" 的用户，飞书适配器也提供"),a("strong",[t._v("实验性")]),t._v("支持，仅需要在配置文件中添加 "),a("code",[t._v("IS_LARK=true")]),t._v(" 即可。")]),t._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("IS_LARK=true\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])]),a("h2",{attrs:{id:"注册飞书适配器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#注册飞书适配器"}},[t._v("#")]),t._v(" 注册飞书适配器")]),t._v(" "),a("p",[t._v("在 "),a("code",[t._v("bot.py")]),t._v(" 中添加：")]),t._v(" "),a("div",{staticClass:"language-python line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" nonebot"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("adapters"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("feishu "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" Bot "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" FeishuBot\n\ndriver"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("register_adapter"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"feishu"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" FeishuBot"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br")])]),a("h2",{attrs:{id:"编写一个适用于飞书适配器的插件并加载"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#编写一个适用于飞书适配器的插件并加载"}},[t._v("#")]),t._v(" 编写一个适用于飞书适配器的插件并加载")]),t._v(" "),a("p",[t._v("插件代码范例：")]),t._v(" "),a("div",{staticClass:"language-python line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" nonebot"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("plugin "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" on_command\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" nonebot"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("typing "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" T_State\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" nonebot"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("adapters"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("feishu "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" Bot "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" FeishuBot"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" MessageEvent\n\nhelper "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" on_command"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"say"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n\n"),a("span",{pre:!0,attrs:{class:"token decorator annotation punctuation"}},[t._v("@helper"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("handle")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("async")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("feishu_helper")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("bot"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" FeishuBot"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" event"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" MessageEvent"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" state"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" T_State"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    message "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" event"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("get_message"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" helper"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("finish"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("message"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" at_sender"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("True")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br")])]),a("p",[t._v("以上代码注册了一个对飞书平台适用的"),a("code",[t._v("say")]),t._v("指令，并会提取"),a("code",[t._v("/say")]),t._v("之后的内容发送到事件所对应的群或私聊。")]),t._v(" "),a("p",[t._v("大功告成！现在可以试试向机器人发送类似"),a("code",[t._v("/say Hello, Feishu!")]),t._v("的消息进行测试了。")])])}),[],!1,null,null,null);s.default=e.exports}}]);