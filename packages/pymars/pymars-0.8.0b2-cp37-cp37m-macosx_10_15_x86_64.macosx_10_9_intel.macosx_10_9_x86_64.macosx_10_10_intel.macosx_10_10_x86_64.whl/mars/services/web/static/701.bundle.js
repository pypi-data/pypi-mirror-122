(self.webpackChunkmars_ui=self.webpackChunkmars_ui||[]).push([[701],{1701:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>A});var r=n(7294),o=n(5697),i=n.n(o),a=n(5977),s=n(1749),l=n(9895),c=n(5517),u=n(5713),p=n(4017),f=n(4949),d=n(5095),h=n(816);function y(e){return(y="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function b(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function m(e,t){return(m=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function g(e,t){return!t||"object"!==y(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function v(e){return(v=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var k=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&m(e,t)}(s,e);var t,n,o,i,a=(o=s,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=v(o);if(i){var n=v(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return g(this,e)});function s(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),(t=a.call(this,e)).state={nodeStatusMap:[{text:"Pending",color:"#FFFFFF"},{text:"Running",color:"#F4B400"},{text:"Succeeded",color:"#00CD95"},{text:"Failed",color:"#E74C3C"},{text:"Cancelled",color:"#BFC9CA"}],inputNodeColor:"#3281a8",outputNodeColor:"#c334eb"},t}return t=s,(n=[{key:"componentDidMount",value:function(){this.g=(new f.graphlib.Graph).setGraph({})}},{key:"componentWillUnmount",value:function(){clearInterval(this.interval)}},{key:"componentDidUpdate",value:function(e,t,n){var r=this;if(void 0!==this.props&&void 0!==this.props.nodes&&0!==this.props.nodes.length){if(e.nodes!==this.props.nodes&&e.dependencies!==this.props.dependencies){(0,p.Z)("#"+this.props.graphName).selectAll("*").remove();var o=(0,p.Z)("#"+this.props.graphName),i=o.append("g");this.g=(new f.graphlib.Graph).setGraph({}),this.props.nodes.forEach((function(e){var t={node:e},n=r.props.nodesStatus[e.id];if("tileableGraph"===r.props.graphName){var o=e.name.indexOf("key")-1;t.label=e.name.substring(0,o)}else"subtaskGraph"===r.props.graphName&&(t.label="");"tileableGraph"===r.props.graphName?t.rx=t.ry=5:"subtaskGraph"===r.props.graphName&&(t.r=20),r.g.setNode(e.id,t);var a=i.append("linearGradient").attr("id","progress-"+e.id),s=r.g.node(e.id);void 0===n?a.append("stop").attr("id","progress-"+e.id+"-stop").attr("stop-color","#FFFFFF").attr("offset",1):-1===n.status&&-1===n.progress?a.append("stop").attr("id","progress-"+e.id+"-stop").attr("stop-color",r.state.inputNodeColor).attr("offset",1):-2===n.status&&-2===n.progress?a.append("stop").attr("id","progress-"+e.id+"-stop").attr("stop-color",r.state.outputNodeColor).attr("offset",1):a.append("stop").attr("id","progress-"+e.id+"-stop").attr("stop-color",r.state.nodeStatusMap[n.status].color).attr("offset",n.progress),a.append("stop").attr("stop-color","#FFFFFF").attr("offset","0"),s.shape=r.props.nodeShape,s.style="cursor: pointer; stroke: #333; fill: url(#progress-"+e.id+")",s.labelStyle="cursor: pointer"})),this.props.dependencies.forEach((function(e){e.linkType&&1===e.linkType?r.g.setEdge(e.fromNodeId,e.toNodeId,{style:"stroke: #333; fill: none; stroke-dasharray: 5, 5;"}):r.g.setEdge(e.fromNodeId,e.toNodeId,{style:"stroke: #333; fill: none;"})}));var a=this.g;a.nodes().forEach((function(e){var t=a.node(e);t.rx=t.ry=5}));var s=new f.render;0!==this.props.nodes.length&&s(i,this.g),i.selectAll("g.node").on("click",(function(e,t){if(r.props.onNodeClick){var n=r.props.nodes.filter((function(e){return e.id===t}))[0];r.props.onNodeClick(e,n)}}));var l=i.node().getBBox(),c=i.node().parentElement,u=l.width,h=l.height,y=c.clientWidth,b=c.clientHeight,m=b>=h?1:b/h;(0,p.Z)("#"+this.props.graphName).select(".output").attr("transform","translate("+(y-u*m)/2+", "+(b-h*m)/2+")");var g=(0,d.sP)().on("zoom",(function(e){i.attr("transform",e.transform)}));o.call(g,g.transform,d.CR.scale(m)),null!==this.g.graph()||void 0!==this.g.graph()?o.attr("height",this.g.graph().height*m+40):o.attr("height",40)}if(e.nodes===this.props.nodes&&e.dependencies===this.props.dependencies&&e.nodesStatus!==this.props.nodesStatus){var v=(0,p.Z)("#"+this.props.graphName);this.props.nodes.forEach((function(e){var t=r.props.nodesStatus[e.id];if(void 0!==t&&t.status>=0&&t.progress>=0){var n=r.g.node(e.id);void 0!==n&&("visibility: hidden"===n.style&&(n.shape=r.props.nodeShape,n.style="cursor: pointer; stroke: #333; fill: url(#progress-"+e.id+")",n.labelStyle="cursor: pointer"),v.select("#progress-"+e.id+"-stop").attr("stop-color",r.state.nodeStatusMap[t.status].color).attr("offset",t.progress))}}))}}}},{key:"render",value:function(){return r.createElement("svg",{id:this.props.graphName,style:this.props.dagStyle})}}])&&b(t.prototype,n),s}(r.Component);function E(e){return(E="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function T(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function S(e,t){return(S=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function O(e,t){return!t||"object"!==E(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function x(e){return(x=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}k.propTypes={graphName:i().string.isRequired,dagStyle:h.D$,nodes:h.aY,nodeShape:i().string.isRequired,nodesStatus:h.nd,dependencies:h.ei,onNodeClick:i().func};var _=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&S(e,t)}(s,e);var t,n,o,i,a=(o=s,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=x(o);if(i){var n=x(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return O(this,e)});function s(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),(t=a.call(this,e)).state={selectedTileable:null,tileables:[],dependencies:[],tileableDetails:{},tileableStatus:[{text:"Pending",color:"#FFFFFF",legendDotXLoc:"430",legendDotYLoc:"20",legendTextXLoc:"440",legendTextYLoc:"21"},{text:"Running",color:"#F4B400",legendDotXLoc:"10",legendDotYLoc:"20",legendTextXLoc:"20",legendTextYLoc:"21"},{text:"Succeeded",color:"#00CD95",legendDotXLoc:"105",legendDotYLoc:"20",legendTextXLoc:"115",legendTextYLoc:"21"},{text:"Failed",color:"#E74C3C",legendDotXLoc:"345",legendDotYLoc:"20",legendTextXLoc:"355",legendTextYLoc:"21"},{text:"Cancelled",color:"#BFC9CA",legendDotXLoc:"225",legendDotYLoc:"20",legendTextXLoc:"235",legendTextYLoc:"21"}]},t}return t=s,(n=[{key:"generateGraphLegendItem",value:function(e,t,n,r,o,i,a){"#FFFFFF"===i?e.append("circle").attr("cx",t).attr("cy",n).attr("r",6).attr("stroke","#333").style("fill",i):e.append("circle").attr("cx",t).attr("cy",n).attr("r",6).style("fill",i),e.append("text").attr("x",r).attr("y",o).text(a).style("font-size","15px").attr("alignment-baseline","middle")}},{key:"fetchGraphDetail",value:function(){var e=this,t=this.props,n=t.sessionId,r=t.taskId;fetch("api/session/".concat(n,"/task/").concat(r,"/tileable_graph?action=get_tileable_graph_as_json")).then((function(e){return e.json()})).then((function(t){e.setState({tileables:t.tileables.map((function(e){return{id:e.tileableId,name:e.tileableName}})),dependencies:t.dependencies.map((function(e){return{fromNodeId:e.fromTileableId,toNodeId:e.toTileableId}}))})}))}},{key:"fetchTileableDetail",value:function(){var e=this,t=this.props,n=t.sessionId,r=t.taskId;fetch("api/session/".concat(n,"/task/").concat(r,"/tileable_detail")).then((function(e){return e.json()})).then((function(t){e.setState({tileableDetails:t})}))}},{key:"componentDidMount",value:function(){var e=this;this.g=(new f.graphlib.Graph).setGraph({}),void 0!==this.interval&&clearInterval(this.interval),this.interval=setInterval((function(){return e.fetchTileableDetail()}),1e3),this.fetchTileableDetail(),this.fetchGraphDetail();var t=(0,p.Z)("#tileables-legend");this.state.tileableStatus.forEach((function(n){return e.generateGraphLegendItem(t,n.legendDotXLoc,n.legendDotYLoc,n.legendTextXLoc,n.legendTextYLoc,n.color,n.text)}))}},{key:"componentWillUnmount",value:function(){clearInterval(this.interval)}},{key:"render",value:function(){return void 0===this.state||void 0===this.state.tileables||void 0===this.state.dependencies||void 0===this.state.tileableDetails?r.createElement("div",null,"Loading"):r.createElement(r.Fragment,null,r.createElement("svg",{id:"tileables-legend",style:{marginLeft:"6%",width:"90%",height:"10%"}}),r.createElement(k,{graphName:"tileableGraph",dagStyle:{margin:30,width:"90%",height:"80%"},nodes:this.state.tileables,nodeShape:"rect",nodesStatus:this.state.tileableDetails,dependencies:this.state.dependencies,onNodeClick:this.props.onTileableClick}))}}])&&T(t.prototype,n),s}(r.Component);_.propTypes={sessionId:i().string.isRequired,taskId:i().string.isRequired,onTileableClick:i().func};var w=n(65),R=n(1423);function C(e){return(C="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function F(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function I(e,t){return(I=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function D(e,t){return!t||"object"!==C(t)&&"function"!=typeof t?j(e):t}function j(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function N(e){return(N=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var L=(0,r.lazy)((function(){return Promise.all([n.e(601),n.e(615)]).then(n.bind(n,2615))})),P=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&I(e,t)}(s,e);var t,n,o,i,a=(o=s,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=N(o);if(i){var n=N(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return D(this,e)});function s(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),(t=a.call(this,e)).state={displayedTileableDetail:0},t.handleDetailTabChange=t.handleDetailTabChange.bind(j(t)),t}return t=s,(n=[{key:"handleDetailTabChange",value:function(e,t){this.setState({displayedTileableDetail:t})}},{key:"render",value:function(){return void 0===this.props?null:this.props.tileable?r.createElement(r.Fragment,null,r.createElement(w.Z,{value:this.state.displayedTileableDetail,onChange:this.handleDetailTabChange},r.createElement(R.Z,{label:"Tileable Info"}),r.createElement(R.Z,{label:"Subtask Info"})),r.createElement("br",null),r.createElement("div",null,0===this.state.displayedTileableDetail?r.createElement(r.Fragment,null,r.createElement("h2",null,"Tileable Graph Info:"),r.createElement("div",null,"Tileable ID: ",r.createElement("br",null),this.props.tileable.id),r.createElement("br",null),r.createElement("div",null,"Tileable Name: ",r.createElement("br",null),this.props.tileable.name),r.createElement("br",null),r.createElement("br",null)):r.createElement(r.Suspense,{fallback:r.createElement("div",null,"Loading...")},r.createElement(L,{sessionId:this.props.sessionId,taskId:this.props.taskId,tileableId:this.props.tileable.id})))):r.createElement(r.Fragment,null,"Select a tileable to view its detail")}}])&&F(t.prototype,n),s}(r.Component);P.propTypes={tileable:i().shape({id:i().string,name:i().string}),sessionId:i().string.isRequired,taskId:i().string.isRequired};const Z=P;function G(e){return(G="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function B(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Y(e,t){return(Y=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function q(e,t){return!t||"object"!==G(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function X(e){return(X=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var M=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Y(e,t)}(p,e);var t,n,o,i,a=(o=p,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=X(o);if(i){var n=X(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return q(this,e)});function p(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,p),(t=a.call(this,e)).state={selectedTileable:null},t}return t=p,(n=[{key:"render",value:function(){var e=this;return void 0===this.props?null:r.createElement(s.Z,{container:!0,spacing:3},r.createElement(s.Z,{item:!0,xs:12},r.createElement(u.Z,null,"Task ",this.props.match.params.task_id)),r.createElement(s.Z,{item:!0,xs:12},r.createElement(l.Z,null,r.createElement(s.Z,{container:!0,spacing:3},r.createElement(s.Z,{item:!0,xs:12,sm:6},r.createElement(_,{sessionId:this.props.match.params.session_id,taskId:this.props.match.params.task_id,onTileableClick:function(t,n){e.setState({selectedTileable:n})}})),r.createElement(c.Z,{orientation:"vertical",flexItem:!0,style:{marginRight:"-1px"}}),r.createElement(s.Z,{item:!0,xs:12,sm:6},r.createElement(s.Z,{item:!0,xs:12},r.createElement(Z,{tileable:this.state.selectedTileable,sessionId:this.props.match.params.session_id,taskId:this.props.match.params.task_id})))))))}}])&&B(t.prototype,n),p}(r.Component);M.propTypes={match:i().shape({params:i().shape({session_id:i().string.isRequired,task_id:i().string.isRequired})})};const A=(0,a.EN)(M)},816:(e,t,n)=>{"use strict";n.d(t,{aY:()=>i,nd:()=>a,ei:()=>s,D$:()=>l});var r=n(5697),o=n.n(r),i=o().arrayOf(o().shape({id:o().string.isRequired,name:o().string})),a=o().shape({id:o().shape({status:o().number.isRequired,progress:o().number.isRequired,subtaskCount:o().number})}),s=o().arrayOf(o().shape({fromNodeId:o().string.isRequired,toNodeId:o().string.isRequired,linkType:o().number})),l=o().shape({margin:o().oneOfType([o().number,o().string]),padding:o().oneOfType([o().number,o().string]),width:o().oneOfType([o().number,o().string]),height:o().oneOfType([o().number,o().string])})}}]);