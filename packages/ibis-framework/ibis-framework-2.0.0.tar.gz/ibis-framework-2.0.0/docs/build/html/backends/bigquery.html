

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>BigQuery &mdash; Ibis 1.4.0+58.g1cd4554.dirty documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
        <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Clickhouse" href="clickhouse.html" />
    <link rel="prev" title="Impala" href="impala.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> Ibis
          

          
            
            <img src="../_static/logo-wide.svg" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                1.4.0+58.g1cd4554.dirty
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../tutorial/index.html">Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user_guide/index.html">User guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api.html">API Reference</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Backends</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="sqlite.html">SQLite</a></li>
<li class="toctree-l2"><a class="reference internal" href="postgres.html">PostgreSQL</a></li>
<li class="toctree-l2"><a class="reference internal" href="mysql.html">MySQL</a></li>
<li class="toctree-l2"><a class="reference internal" href="impala.html">Impala</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">BigQuery</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#bigquery-quickstart">BigQuery Quickstart</a></li>
<li class="toctree-l3"><a class="reference internal" href="#api">API</a></li>
<li class="toctree-l3"><a class="reference internal" href="#the-bigquery-client-object">The BigQuery client object</a></li>
<li class="toctree-l3"><a class="reference internal" href="#user-defined-functions-udf">User Defined functions (UDF)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#privacy">Privacy</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#google-account-and-user-data">Google account and user data</a></li>
<li class="toctree-l4"><a class="reference internal" href="#policies-for-application-authors">Policies for application authors</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="clickhouse.html">Clickhouse</a></li>
<li class="toctree-l2"><a class="reference internal" href="spark.html">PySpark/Spark SQL</a></li>
<li class="toctree-l2"><a class="reference internal" href="pandas.html">pandas</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../release/index.html">Release Notes</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Ibis</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="index.html">Backends</a> &raquo;</li>
        
      <li>BigQuery</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/backends/bigquery.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<div class="section" id="bigquery">
<span id="backends-bigquery"></span><h1>BigQuery<a class="headerlink" href="#bigquery" title="Permalink to this headline">¶</a></h1>
<p>To use the BigQuery client, you will need a Google Cloud Platform account.
Use the <a class="reference external" href="https://cloud.google.com/bigquery/docs/sandbox">BigQuery sandbox</a>
to try the service for free.</p>
<div class="section" id="bigquery-quickstart">
<span id="install-bigquery"></span><h2><a class="reference external" href="https://cloud.google.com/bigquery/">BigQuery</a> Quickstart<a class="headerlink" href="#bigquery-quickstart" title="Permalink to this headline">¶</a></h2>
<p>Install dependencies for Ibis’s BigQuery dialect:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">install</span> <span class="n">ibis</span><span class="o">-</span><span class="n">framework</span><span class="p">[</span><span class="n">bigquery</span><span class="p">]</span>
</pre></div>
</div>
<p>Create a client by passing in the project id and dataset id you wish to operate
with:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">con</span> <span class="o">=</span> <span class="n">ibis</span><span class="o">.</span><span class="n">bigquery</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">project_id</span><span class="o">=</span><span class="s1">&#39;ibis-gbq&#39;</span><span class="p">,</span> <span class="n">dataset_id</span><span class="o">=</span><span class="s1">&#39;testing&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>By default ibis assumes that the BigQuery project that’s billed for queries is
also the project where the data lives.</p>
<p>However, it’s very easy to query data that does <strong>not</strong> live in the billing
project.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>When you run queries against data from other projects <strong>the billing project
will still be billed for any and all queries</strong>.</p>
</div>
<p>If you want to query data that lives in a different project than the billing
project you can use the <code class="xref py py-meth docutils literal notranslate"><span class="pre">ibis.bigquery.client.BigQueryClient.database()</span></code>
method of <code class="xref py py-class docutils literal notranslate"><span class="pre">ibis.bigquery.client.BigQueryClient</span></code> objects:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">db</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">database</span><span class="p">(</span><span class="s1">&#39;other-data-project.other-dataset&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">my_awesome_table</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t</span><span class="o">.</span><span class="n">sweet_column</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>  <span class="c1"># runs against the billing project</span>
</pre></div>
</div>
</div>
<div class="section" id="api">
<h2>API<a class="headerlink" href="#api" title="Permalink to this headline">¶</a></h2>
<p>The BigQuery client is accessible through the <code class="docutils literal notranslate"><span class="pre">ibis.bigquery</span></code> namespace.
See <a class="reference internal" href="#backends-bigquery"><span class="std std-ref">BigQuery</span></a> for a tutorial on using this backend.</p>
<p>Use the <code class="docutils literal notranslate"><span class="pre">ibis.bigquery.connect</span></code> function to create a BigQuery
client. If no <code class="docutils literal notranslate"><span class="pre">credentials</span></code> are provided, the
<a class="reference external" href="https://pydata-google-auth.readthedocs.io/en/latest/api.html#pydata_google_auth.default" title="(in pydata-google-auth v0.1.0)"><code class="xref py py-func docutils literal notranslate"><span class="pre">pydata_google_auth.default()</span></code></a> function fetches default credentials.</p>
<table class="longtable docutils align-default">
<colgroup>
<col style="width: 10%" />
<col style="width: 90%" />
</colgroup>
<tbody>
</tbody>
</table>
</div>
<div class="section" id="the-bigquery-client-object">
<h2>The BigQuery client object<a class="headerlink" href="#the-bigquery-client-object" title="Permalink to this headline">¶</a></h2>
<p>To use Ibis with BigQuery, you first must connect to BigQuery using the
<code class="xref py py-func docutils literal notranslate"><span class="pre">ibis.bigquery.connect()</span></code> function, optionally supplying Google API
credentials:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">ibis</span>

<span class="n">client</span> <span class="o">=</span> <span class="n">ibis</span><span class="o">.</span><span class="n">bigquery</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
    <span class="n">project_id</span><span class="o">=</span><span class="n">YOUR_PROJECT_ID</span><span class="p">,</span>
    <span class="n">dataset_id</span><span class="o">=</span><span class="s1">&#39;bigquery-public-data.stackoverflow&#39;</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="user-defined-functions-udf">
<span id="udf-bigquery"></span><h2>User Defined functions (UDF)<a class="headerlink" href="#user-defined-functions-udf" title="Permalink to this headline">¶</a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>BigQuery only supports element-wise UDFs at this time.</p>
</div>
<p>BigQuery supports UDFs through JavaScript. Ibis provides support for this by
turning Python code into JavaScript.</p>
<p>The interface is very similar to the pandas UDF API:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">ibis.expr.datatypes</span> <span class="k">as</span> <span class="nn">dt</span>
<span class="kn">from</span> <span class="nn">ibis.bigquery</span> <span class="kn">import</span> <span class="n">udf</span>

<span class="nd">@udf</span><span class="p">([</span><span class="n">dt</span><span class="o">.</span><span class="n">double</span><span class="p">],</span> <span class="n">dt</span><span class="o">.</span><span class="n">double</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">my_bigquery_add_one</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="mf">1.0</span>
</pre></div>
</div>
<p>Ibis will parse the source of the function and turn the resulting Python AST
into JavaScript source code (technically, ECMAScript 2015). Most of the Python
language is supported including classes, functions and generators.</p>
<p>When you want to use this function you call it like any other Python
function–only it must be called on an ibis expression:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">t</span> <span class="o">=</span> <span class="n">ibis</span><span class="o">.</span><span class="n">table</span><span class="p">([(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;double&#39;</span><span class="p">)])</span>
<span class="n">expr</span> <span class="o">=</span> <span class="n">my_bigquery_add_one</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">a</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">ibis</span><span class="o">.</span><span class="n">bigquery</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">expr</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="section" id="privacy">
<span id="bigquery-privacy"></span><h2>Privacy<a class="headerlink" href="#privacy" title="Permalink to this headline">¶</a></h2>
<p>This package is subject to the <a class="reference external" href="https://numfocus.org/privacy-policy">NumFocus privacy policy</a>. Your use of Google APIs with this
module is subject to each API’s respective <a class="reference external" href="https://developers.google.com/terms/">terms of service</a>.</p>
<div class="section" id="google-account-and-user-data">
<h3>Google account and user data<a class="headerlink" href="#google-account-and-user-data" title="Permalink to this headline">¶</a></h3>
<div class="section" id="accessing-user-data">
<h4>Accessing user data<a class="headerlink" href="#accessing-user-data" title="Permalink to this headline">¶</a></h4>
<p>The <code class="xref py py-func docutils literal notranslate"><span class="pre">connect()</span></code> function provides access to data
stored in Google BigQuery and other sources such as Google Sheets or Cloud
Storage, via the federated query feature. Your machine communicates directly
with the Google APIs.</p>
</div>
<div class="section" id="storing-user-data">
<h4>Storing user data<a class="headerlink" href="#storing-user-data" title="Permalink to this headline">¶</a></h4>
<p>By default, your credentials are stored to a local file, such as
<code class="docutils literal notranslate"><span class="pre">~/.config/pydata/ibis.json</span></code>. All user data is stored on
your local machine. <strong>Use caution when using this library on a shared
machine</strong>.</p>
</div>
<div class="section" id="sharing-user-data">
<h4>Sharing user data<a class="headerlink" href="#sharing-user-data" title="Permalink to this headline">¶</a></h4>
<p>The BigQuery client only communicates with Google APIs. No user data is
shared with PyData, NumFocus, or any other servers.</p>
</div>
</div>
<div class="section" id="policies-for-application-authors">
<h3>Policies for application authors<a class="headerlink" href="#policies-for-application-authors" title="Permalink to this headline">¶</a></h3>
<p>Do not use the default client ID when using Ibis from an application,
library, or tool. Per the <a class="reference external" href="https://developers.google.com/terms/api-services-user-data-policy">Google User Data Policy</a>, your
application must accurately represent itself when authenticating to Google
API services.</p>
<div class="section" id="extending-the-bigquery-backend">
<h4>Extending the BigQuery backend<a class="headerlink" href="#extending-the-bigquery-backend" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p>Create a Google Cloud project.</p></li>
<li><p>Set the <code class="docutils literal notranslate"><span class="pre">GOOGLE_BIGQUERY_PROJECT_ID</span></code> environment variable.</p></li>
<li><p>Populate test data: <code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">ci/datamgr.py</span> <span class="pre">bigquery</span></code></p></li>
<li><p>Run the test suite: <code class="docutils literal notranslate"><span class="pre">pytest</span> <span class="pre">ibis/bigquery/tests</span></code></p></li>
</ul>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="clickhouse.html" class="btn btn-neutral float-right" title="Clickhouse" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="impala.html" class="btn btn-neutral float-left" title="Impala" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021, Ibis Developers.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
  
 
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-65303298-2', 'auto');
  ga('send', 'pageview');

</script>


</body>
</html>