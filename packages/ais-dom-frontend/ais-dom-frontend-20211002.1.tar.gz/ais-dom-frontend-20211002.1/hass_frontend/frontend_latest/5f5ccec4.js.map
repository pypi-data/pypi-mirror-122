{"version":3,"file":"5f5ccec4.js","mappings":";AAmFA;AACA;;;AAGA;;AAWA;AACA;;;;AAIA;;;AA+BA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAjHA","sources":["webpack://home-assistant-frontend/./src/panels/developer-tools/statistics/developer-tools-statistics.ts"],"sourcesContent":["import \"@material/mwc-button/mwc-button\";\nimport { HassEntity } from \"home-assistant-js-websocket\";\nimport { css, CSSResultGroup, html, LitElement } from \"lit\";\nimport { customElement, property, state } from \"lit/decorators\";\nimport memoizeOne from \"memoize-one\";\nimport { fireEvent } from \"../../../common/dom/fire_event\";\nimport { computeStateName } from \"../../../common/entity/compute_state_name\";\nimport \"../../../components/data-table/ha-data-table\";\nimport type { DataTableColumnContainer } from \"../../../components/data-table/ha-data-table\";\nimport {\n  getStatisticIds,\n  StatisticsMetaData,\n  StatisticsValidationResult,\n  validateStatistics,\n} from \"../../../data/history\";\nimport { showAlertDialog } from \"../../../dialogs/generic/show-dialog-box\";\nimport { haStyle } from \"../../../resources/styles\";\nimport { HomeAssistant } from \"../../../types\";\nimport { showFixStatisticsUnitsChangedDialog } from \"./show-dialog-statistics-fix-units-changed\";\n\n@customElement(\"developer-tools-statistics\")\nclass HaPanelDevStatistics extends LitElement {\n  @property({ attribute: false }) public hass!: HomeAssistant;\n\n  @property({ type: Boolean }) public narrow!: boolean;\n\n  @state() private _data: (StatisticsMetaData & {\n    issues?: StatisticsValidationResult[];\n    state?: HassEntity;\n  })[] = [] as StatisticsMetaData[];\n\n  protected firstUpdated() {\n    this._validateStatistics();\n  }\n\n  /* eslint-disable lit/no-template-arrow */\n  private _columns = memoizeOne(\n    (localize): DataTableColumnContainer => ({\n      state: {\n        title: \"Entity\",\n        sortable: true,\n        filterable: true,\n        grows: true,\n        template: (entityState, data: any) =>\n          html`${entityState\n            ? computeStateName(entityState)\n            : data.statistic_id}`,\n      },\n      statistic_id: {\n        title: \"Statistic id\",\n        sortable: true,\n        filterable: true,\n        hidden: this.narrow,\n        width: \"30%\",\n      },\n      unit_of_measurement: {\n        title: \"Unit\",\n        sortable: true,\n        filterable: true,\n        width: \"10%\",\n      },\n      issues: {\n        title: \"Issue\",\n        sortable: true,\n        filterable: true,\n        direction: \"asc\",\n        width: \"30%\",\n        template: (issues) =>\n          html`${issues\n            ? issues.map(\n                (issue) =>\n                  localize(\n                    `ui.panel.developer-tools.tabs.statistics.issues.${issue.type}`,\n                    issue.data\n                  ) || issue.type\n              )\n            : \"\"}`,\n      },\n      fix: {\n        title: \"\",\n        template: (_, data: any) =>\n          html`${data.issues\n            ? html`<mwc-button\n                @click=${(ev) => this._fixIssue(ev)}\n                .data=${data.issues}\n              >\n                Fix issue\n              </mwc-button>`\n            : \"\"}`,\n        width: \"113px\",\n      },\n    })\n  );\n  /* eslint-enable lit/no-template-arrow */\n\n  protected render() {\n    return html`\n      <ha-data-table\n        .columns=${this._columns(this.hass.localize)}\n        .data=${this._data}\n        noDataText=\"No issues found!\"\n        id=\"statistic_id\"\n        clickable\n        @row-click=${this._rowClicked}\n      ></ha-data-table>\n    `;\n  }\n\n  private _rowClicked(ev) {\n    const id = ev.detail.id;\n    if (id in this.hass.states) {\n      fireEvent(this, \"hass-more-info\", { entityId: id });\n    }\n  }\n\n  private async _validateStatistics() {\n    const [statisticIds, issues] = await Promise.all([\n      getStatisticIds(this.hass),\n      validateStatistics(this.hass),\n    ]);\n\n    this._data = statisticIds.map((statistic) => ({\n      ...statistic,\n      state: this.hass.states[statistic.statistic_id],\n      issues: issues[statistic.statistic_id],\n    }));\n  }\n\n  private _fixIssue(ev) {\n    const issue = ev.currentTarget.data[0] as StatisticsValidationResult;\n    if (issue.type === \"unsupported_unit\") {\n      showAlertDialog(this, {\n        title: \"Unsupported unit\",\n        text: html`The unit of your entity is not a supported unit for the\n          device class of the entity, ${issue.data.device_class}.\n          <br />Statistics can not be generated until this entity has a\n          supported unit.<br /><br />If this unit was provided by an\n          integration, this is a bug. Please report an issue.<br /><br />If you\n          have set this unit yourself, and want to have statistics generated,\n          make sure the unit matched the device class. The supported units are\n          documented in the\n          <a\n            href=\"https://developers.home-assistant.io/docs/core/entity/sensor\"\n            target=\"_blank\"\n          >\n            developer documentation</a\n          >.`,\n      });\n      return;\n    }\n    if (issue.type === \"units_changed\") {\n      showFixStatisticsUnitsChangedDialog(this, {\n        issue,\n        fixedCallback: () => {\n          this._validateStatistics();\n        },\n      });\n      return;\n    }\n    showAlertDialog(this, {\n      title: \"Fix issue\",\n      text: \"Fixing this issue is not supported yet.\",\n    });\n  }\n\n  static get styles(): CSSResultGroup {\n    return [\n      haStyle,\n      css`\n        .content {\n          padding: 16px;\n        }\n\n        th {\n          padding: 0 8px;\n          text-align: left;\n          font-size: var(\n            --paper-input-container-shared-input-style_-_font-size\n          );\n        }\n\n        :host([rtl]) th {\n          text-align: right;\n        }\n\n        tr {\n          vertical-align: top;\n          direction: ltr;\n        }\n\n        tr:nth-child(odd) {\n          background-color: var(--table-row-background-color, #fff);\n        }\n\n        tr:nth-child(even) {\n          background-color: var(--table-row-alternative-background-color, #eee);\n        }\n        td {\n          padding: 4px;\n          min-width: 200px;\n          word-break: break-word;\n        }\n      `,\n    ];\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    \"developer-tools-statistics\": HaPanelDevStatistics;\n  }\n}\n"],"names":[],"sourceRoot":""}